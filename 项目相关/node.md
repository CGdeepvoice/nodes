项目主要相关：
    体检数据分析，团体体检数据生成报告。
其中包括几个模块：1. 数据提取及标准化  2. 数据保存 3. 数据校验 4. 数据分析 5. 统计 6. 呈现

# 数据提取及标准化
分为几个渠道：
1. excel表格
    - 每个人一行数据，包含了个人信息，指标信息和综述信息（综述：医生根据体检报告写出结论）
    - 每人一份excel， 固定格式，前几行是个人信息， 后面是指标信息，最后为综述信息

    处理方式：通过pandas.from_excel() 生成dataframe。根据df.columns手动写出与标准字段的对应关系，一般三种，个人信息，是一个字典类型。综述是字符串类型，指标是对象列表，每个指标是一个字典，总体是一个列表。

2. pdf:
   处理方式：使用pdfminer分析。分析每个文件的特点，获取需要的数据

3. 接口： 通过封装接口，定时下载数据

# 数据保存
使用mongoengine，通过django-orm创建模型，保存到Mongodb,每个报告是一个document.每个来源是一个collection
为什么保存到Mongo, 业务数据库是sqlserver?
以前的流程是，数据处理之后，根据个人信息创建用户，然后创建其他业务记录，如指标，综述，创建之后与用户相关联，这时候用户可以通过个人端（app、公众号）来查看自己的报告。管理端可以查看团体的整体健康情况，如团体的危险指标前10，男女分布情况等。
但是这里有一个问题，如果用户自己修改了数据，会影响团体统计。而且有的团体只需要做一个关于团体健康的报告，不需要进行创建用户等信息。数据不全的话可能一个人两年会有两个账号，数据不好同步。
所以先对原始数据进行标准化，直接保存原始数据到Mongodb里，保存原始文件的路径。如果分析引擎升级可以重新再次分析。
# 数据校验
主要分析字段是否合法。如姓名、手机号、指标是否在区间内。人工核对
# 导入业务数据库
可以选择是否导入业务数据库。
如果导入就创建用户，导入指标
# 数据分析
这里也有两种方案：
1. 正常导入到业务数据库，使用消息队列rabbitmq传输数据到分析引擎，导入一份报告发送一个消息到exchange,路由到分析引擎队列，分析引擎取到数据后对报告进行分析，这里发送消息时报告的id值。分析引擎接收到之后去数据库取出数据进行分析，分析结果保存到数据库。
2. 因为可以不保存到数据库，直接直接分析，从Mongodb读取出数据，函数调用进行分析，分析结果保存到Mongodb。相同报告document的其他字段

这里分析引擎包含两个部分：指标的分析，和标签的分析。
指标的分析是根据特征的指标信息和个人信息进行计算，比如体重指数对不同的性别和年龄段的标准值不同。

标签分析：
标签分析是一个单独的服务，使用django部署，接口化调用。
将综述信息，提取出有用的标签。如肝囊肿 进行分词 分词为 肝 囊肿， 进行匹配，匹配为肝脏囊肿（数据库中标准名称）。
这里有两个过程，分词，匹配。

关于分词：大概分为两种：
1. 基于字符串匹配，扫描字符串，使用正向/逆向最大匹配等基于字典的分词算法。优点是速度快，时间复杂度低，实现简单。
2. 基于统计及机器学习的分词方式，非词典方式。hmm。事先对中文进行建模，根据观测到的数据对模型参数进行估计训练。jieba分词。

项目里使用的是mmseg属于第一种，因为医用词库比较简单，不需要经常更新。正确率高速度快就足够了。
主要思想是每次从一个完整的句子里，从左向右的顺序，识别出多个不同的三个词的组合，然后根据下面4条消歧规则选出最佳的备选词组合。

分词之后进行匹配，使用最大正向匹配。利用标签树保存映射关系，对分词进行匹配。

这里的服务采用了单例模式，每个进程在启动时加载，使用一个redis的一个键值作为版本号，同步不同进程之间的数据。

# 统计
这里的统计信息主要是年龄段、性别、重要的常见指标异常（空腹血糖，甘油三酯，总胆固醇，低密度脂蛋白，血压，体重指数），疾病标签（高血压病、脂肪肝），风险标签（白细胞异常、血脂异常）
1. 总体情况，总人数，男女人数，去重的数据，不同年龄段的男女人数。

    ```sql
    case 
        when age <= 35 then 0
        when age > 36 then 1
        else 2
    end as age_range
    ```
2. 每个标签组的排序，如疾病标签前十，风险标签前10.
3. 每个指标上的人员分布，如总胆固醇，各个年龄段的人员分布情况

这里生成统计库，将需要的信息保存到mongodb，每次使用group unwind total sum进行统计，统计结果再转换成需要的格式，使用pandas进行转换。这里需要详细写。

# 呈现
生成word文档，网页。
word文档看一下怎么生成。

主要介绍 pdf读取，  分词匹配， mongo统计。